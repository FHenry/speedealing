(function(c){c.fn.makeEditable=function(z){function s(f){return a.fnGetRowID(c(f.parentNode))}function t(f){if(!a.bDisableEditing){var g={event:"dblclick",callback:function(c,g){a.fnEndProcessingMode();var f="";if(u==c){var b=d.fnGetPosition(this);d.fnUpdate(sNewCellDisplayValue,b[0],b[2]);f="success"}else b=d.fnGetPosition(this),d.fnUpdate(v,b[0],b[2]),a.fnShowError(c,"update"),f="failure";a.fnOnEdited(f,v,sNewCellDisplayValue,b[0],b[1],b[2]);null!=g.fnOnCellUpdated&&g.fnOnCellUpdated(f,c,g);w()},
onsubmit:function(f,g){var b=c("input,select,textarea",this);v=g.revert;u=c("input,select,textarea",c(this)).val();if(1==b.length){var d=b[0];sNewCellDisplayValue="select"==d.nodeName.toLowerCase()||"select"==d.tagName.toLowerCase()?c("option:selected",d).text():u}if(!a.fnOnEditing(b))return!1;if(null!=f.cssclass)return b.addClass(f.cssclass),!b.valid()||0==b.valid()?!1:!0},submitdata:function(){n=j._iDisplayStart;a.fnStartProcessingMode();var c=s(this),b=d.fnGetPosition(this)[0],f=d.fnGetPosition(this)[1],
g=d.fnGetPosition(this)[2],e=d.fnSettings().aoColumns[g].sName;if(null==e||""==e)e=d.fnSettings().aoColumns[g].sTitle;return{id:c,rowId:b,columnPosition:f,columnId:g,columnName:e}},onerror:function(){a.fnEndProcessingMode();a.fnShowError("Cell cannot be updated(Server error)","update");a.fnOnEdited("failure")},height:a.sEditorHeight,width:a.sEditorWidth},b=null;if(null!=a.aoColumns)for(var k=0;k<a.aoColumns.length;k++){if(null!=a.aoColumns[k]){var b=c("td:nth-child("+(k+1)+")",f),e=g,e=c.extend({},
g,a.aoColumns[k]),h=a.sUpdateURL;try{null!=e.sUpdateURL&&(h=e.sUpdateURL)}catch(l){}b.editable(h,e)}}else b=c("td:not(."+a.sReadOnlyCellClass+")",f),b.editable(a.sUpdateURL,g)}}function p(f){if(a.fnOnAdding()&&b.valid()){n=j._iDisplayStart;a.fnStartProcessingMode();var g=b.serialize();c.ajax({url:a.sAddURL,data:g,type:a.sAddHttpMethod,dataType:"text",success:A,error:function(c){a.fnEndProcessingMode();a.fnShowError(c.responseText,"add");a.fnOnAdded("failure")}})}f.stopPropagation();f.preventDefault()}
function A(f){a.fnEndProcessingMode();if(a.fnOnNewRowPosted(f)){var g=d.fnSettings().aoColumns.length,e=[];c("input:text[rel],input:radio[rel][checked],input:hidden[rel],select[rel],textarea[rel],span.datafield[rel]",b).each(function(){var b=c(this).attr("rel"),d="";b>=g?a.fnShowError("In the add form is placed input element with the name '"+c(this).attr("name")+"' with the 'rel' attribute that must be less than a column count - "+g,"add"):(d="select"==this.nodeName.toLowerCase()||"select"==this.tagName.toLowerCase()?
c("option:selected",this).text():"span"==this.nodeName.toLowerCase()||"span"==this.tagName.toLowerCase()?c(this).html():this.value,d=d.replace(a.sIDToken,f),e[b]=d)});var k=d.fnAddData(e),k=d.fnGetNodes(k);t(k);a.fnSetRowID(c(k),f);b.dialog("close");c(b)[0].reset();c(".error",c(b)).html("");w();a.fnOnAdded("success")}}function x(a){c(b).validate().resetForm();c(b)[0].reset();c(".error",c(b)).html("");c(".error",c(b)).hide();b.dialog("close");a.stopPropagation();a.preventDefault()}function q(){null!=
a.oDeleteRowButtonOptions?e.button("option","disabled",!0):e.attr("disabled","true")}function r(b,g){var d=g;null==g&&(d=a.sDeleteURL);a.fnStartProcessingMode();var e=c.extend(a.oDeleteParameters,{id:b});c.ajax({url:d,type:a.sDeleteHttpMethod,data:e,success:B,dataType:"text",error:function(c){a.fnEndProcessingMode();a.fnShowError(c.responseText,"delete");a.fnOnDeleted("failure")}})}function y(){n=j._iDisplayStart;if(0==c("tr."+a.sSelectedRowClass+" td",d).length)q();else{var b=s(c("tr."+a.sSelectedRowClass+
" td",d)[0]);a.fnOnDeleting(c("tr."+a.sSelectedRowClass,d),b,r)&&r(b)}}function B(b){a.fnEndProcessingMode();var g=c("tr."+a.sSelectedRowClass,d)[0];"ok"==b||""==b?(d.fnDeleteRow(g),q(),w(),a.fnOnDeleted("success")):(a.fnShowError(b,"delete"),a.fnOnDeleted("failure"))}function w(){!1===j.oFeatures.bServerSide&&(j._iDisplayStart=n,j.oApi._fnCalculateEnd(j),j.oApi._fnDraw(j))}var n=0,d,h,e,l,m,b,a,v,u,j;d=this;a=c.extend({sUpdateURL:"UpdateData",sAddURL:"AddData",sDeleteURL:"DeleteData",sAddNewRowFormId:"formAddNewRow",
oAddNewRowFormOptions:{autoOpen:!1,modal:!0},sAddNewRowButtonId:"btnAddNewRow",oAddNewRowButtonOptions:null,sAddNewRowOkButtonId:"btnAddNewRowOk",sAddNewRowCancelButtonId:"btnAddNewRowCancel",oAddNewRowOkButtonOptions:{label:"Ok"},oAddNewRowCancelButtonOptions:{label:"Cancel"},sDeleteRowButtonId:"btnDeleteRow",oDeleteRowButtonOptions:null,sSelectedRowClass:"row_selected",sReadOnlyCellClass:"read_only",sAddDeleteToolbarSelector:".add_delete_toolbar",fnShowError:function(a){alert(a)},fnStartProcessingMode:function(){d.fnSettings().oFeatures.bProcessing&&
c(".dataTables_processing").css("visibility","visible")},fnEndProcessingMode:function(){d.fnSettings().oFeatures.bProcessing&&c(".dataTables_processing").css("visibility","hidden")},aoColumns:null,fnOnDeleting:function(){return confirm("Are you sure that you want to delete this record?")},fnOnDeleted:function(){},fnOnAdding:function(){return!0},fnOnNewRowPosted:function(){return!0},fnOnAdded:function(){},fnOnEditing:function(){return!0},fnOnEdited:function(){},sAddHttpMethod:"POST",sDeleteHttpMethod:"POST",
fnGetRowID:function(a){return a.attr("id")},fnSetRowID:function(a,c){a.attr("id",c)},sEditorHeight:"100%",sEditorWidth:"100%",bDisableEditing:!1,oDeleteParameters:{},sIDToken:"DATAROWID"},z);j=d.fnSettings();return this.each(function(){null!=d.fnSettings().sAjaxSource?d.fnSettings().aoDrawCallback.push({fn:function(){t(d.fnGetNodes());c(d.fnGetNodes()).each(function(){var b=d.fnGetPosition(this),b=d.fnGetData(b)[0];a.fnSetRowID(c(this),b)})},sName:"fnApplyEditable"}):t(d.fnGetNodes());b=c("#"+a.sAddNewRowFormId);
if(0!=b.length){null!=a.oAddNewRowFormOptions?a.oAddNewRowFormOptions.autoOpen=!1:a.oAddNewRowFormOptions={autoOpen:!1};b.dialog(a.oAddNewRowFormOptions);h=c("#"+a.sAddNewRowButtonId);if(0!=h.length)h.click(function(){b.dialog("open")});else{if(0==c(a.sAddDeleteToolbarSelector).length)throw"Cannot find a button with an id '"+a.sAddNewRowButtonId+"', od placeholder with an id '"+a.sAddDeleteToolbarSelector+"' that should be used for adding new row although form for adding new record is specified";
h=null}"form"==b[0].nodeName.toLowerCase()?(b.unbind("submit"),b.submit(function(a){p(a);return!1})):(c("form",b[0]).unbind("submit"),c("form",b[0]).submit(function(a){p(a);return!1}));var f=[];l=c("#"+a.sAddNewRowOkButtonId,b);if(0==l.length){if(null==a.oAddNewRowOkButtonOptions.text||""==a.oAddNewRowOkButtonOptions.text)a.oAddNewRowOkButtonOptions.text="Ok";a.oAddNewRowOkButtonOptions.click=p;a.oAddNewRowOkButtonOptions.id=a.sAddNewRowOkButtonId;f.push(a.oAddNewRowOkButtonOptions)}else l.click(p);
m=c("#"+a.sAddNewRowCancelButtonId);if(0==m.length){if(null==a.oAddNewRowCancelButtonOptions.text||""==a.oAddNewRowCancelButtonOptions.text)a.oAddNewRowCancelButtonOptions.text="Cancel";a.oAddNewRowCancelButtonOptions.click=x;a.oAddNewRowCancelButtonOptions.id=a.sAddNewRowCancelButtonId;f.push(a.oAddNewRowCancelButtonOptions)}else m.click(x);0<f.length&&b.dialog("option","buttons",f);l=c("#"+a.sAddNewRowOkButtonId);m=c("#"+a.sAddNewRowCancelButtonId)}else b=null;e=c("#"+a.sDeleteRowButtonId);0!=e.length?
e.click(y):e=null;oAddDeleteToolbar=c(a.sAddDeleteToolbarSelector);0!=oAddDeleteToolbar.length&&(null==h&&(""!=a.sAddNewRowButtonId&&null!=b)&&(oAddDeleteToolbar.append("<button id='"+a.sAddNewRowButtonId+"' class='add_row'>Add</button>"),h=c("#"+a.sAddNewRowButtonId),h.click(function(){b.dialog("open")})),null==e&&""!=a.sDeleteRowButtonId&&(oAddDeleteToolbar.append("<button id='"+a.sDeleteRowButtonId+"' class='delete_row'>Delete</button>"),e=c("#"+a.sDeleteRowButtonId),e.click(y)));null!=e&&(null!=
a.oDeleteRowButtonOptions&&e.button(a.oDeleteRowButtonOptions),q());null!=h&&null!=a.oAddNewRowButtonOptions&&h.button(a.oAddNewRowButtonOptions);null!=l&&null!=a.oAddNewRowOkButtonOptions&&l.button(a.oAddNewRowOkButtonOptions);null!=m&&null!=a.oAddNewRowCancelButtonOptions&&m.button(a.oAddNewRowCancelButtonOptions);c(".table-action-deletelink",d).live("click",function(b){b.preventDefault();b.stopPropagation();b=c(this).attr("href");if(null==b||""==b)b=a.sDeleteURL;n=j._iDisplayStart;var d=c(this).parents("td")[0],
e=c(this).parents("tr")[0];c(e).addClass(a.sSelectedRowClass);e=s(d);a.fnOnDeleting(d,e,r)&&r(e,b)});c("tbody",d).click(function(b){c(b.target.parentNode).hasClass(a.sSelectedRowClass)?(c(b.target.parentNode).removeClass(a.sSelectedRowClass),null!=e&&q()):(c(d.fnSettings().aoData).each(function(){c(this.nTr).removeClass(a.sSelectedRowClass)}),c(b.target.parentNode).addClass(a.sSelectedRowClass),null!=e&&(null!=a.oDeleteRowButtonOptions?e.button("option","disabled",!1):e.removeAttr("disabled")))})})}})(jQuery);