(function(b){function f(a,b){return this instanceof f?this.init(a,b):new f(a,b)}b.fn.document=function(){var a=this[0];return"iframe"==a.nodeName.toLowerCase()?a.contentWindow.document:b(this)};b.fn.documentSelection=function(){var a=this[0];return a.contentWindow.document.selection?a.contentWindow.document.selection.createRange().text:a.contentWindow.getSelection().toString()};b.fn.wysiwyg=function(a){if(0<arguments.length&&arguments[0].constructor==String){for(var d=arguments[0].toString(),g=[],
e=1;e<arguments.length;e++)g[e-1]=arguments[e];return d in f?this.each(function(){b.data(this,"wysiwyg").designMode();f[d].apply(this,g)}):this}e={};a&&a.controls&&(e=a.controls,delete a.controls);a=b.extend({html:'<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">STYLE_SHEET</head><body>INITIAL_CONTENT</body></html>',
css:{},debug:!1,autoSave:!0,rmUnwantedBr:!0,controls:{},messages:{}},a);b.extend(a.messages,f.MSGS_EN);b.extend(a.controls,f.TOOLBAR);for(var c in e)c in a.controls?b.extend(a.controls[c],e[c]):a.controls[c]=e[c];return this.each(function(){f(this,a)})};b.extend(f,{insertImage:function(a){var d=b.data(this,"wysiwyg");d.constructor==f&&(a&&0<a.length)&&d.editorDoc.execCommand("insertImage",!1,a)},createLink:function(a){var d=b.data(this,"wysiwyg");d.constructor==f&&(a&&0<a.length)&&(0<b(d.editor).documentSelection().length?
(d.editorDoc.execCommand("unlink",!1,[]),d.editorDoc.execCommand("createLink",!1,a)):d.options.messages.nonSelection&&alert(d.options.messages.nonSelection))},clear:function(){var a=b.data(this,"wysiwyg");a.setContent("");a.saveContent()},MSGS_EN:{nonSelection:"select the text you wish to link"},TOOLBAR:{bold:{visible:!0,tags:["b","strong"],css:{fontWeight:"bold"}},italic:{visible:!0,tags:["i","em"],css:{fontStyle:"italic"}},strikeThrough:{visible:!1,tags:["s","strike"],css:{textDecoration:"line-through"}},
underline:{visible:!1,tags:["u"],css:{textDecoration:"underline"}},separator00:{visible:!1,separator:!0},justifyLeft:{visible:!1,css:{textAlign:"left"}},justifyCenter:{visible:!1,tags:["center"],css:{textAlign:"center"}},justifyRight:{visible:!1,css:{textAlign:"right"}},justifyFull:{visible:!1,css:{textAlign:"justify"}},separator01:{visible:!1,separator:!0},indent:{visible:!1},outdent:{visible:!1},separator02:{visible:!1,separator:!0},subscript:{visible:!1,tags:["sub"]},superscript:{visible:!1,tags:["sup"]},
separator03:{visible:!1,separator:!0},undo:{visible:!1},redo:{visible:!1},separator04:{visible:!1,separator:!0},insertOrderedList:{visible:!1,tags:["ol"]},insertUnorderedList:{visible:!1,tags:["ul"]},insertHorizontalRule:{visible:!1,tags:["hr"]},separator05:{separator:!0},createLink:{visible:!0,exec:function(){if(0<b(this.editor).documentSelection().length)if(b.browser.msie)this.editorDoc.execCommand("createLink",!0,null);else{var a=prompt("URL","http://");a&&0<a.length&&(this.editorDoc.execCommand("unlink",
!1,[]),this.editorDoc.execCommand("createLink",!1,a))}else this.options.messages.nonSelection&&alert(this.options.messages.nonSelection)},tags:["a"]},insertImage:{visible:!0,exec:function(){if(b.browser.msie)this.editorDoc.execCommand("insertImage",!0,null);else{var a=prompt("URL","http://");a&&0<a.length&&this.editorDoc.execCommand("insertImage",!1,a)}},tags:["img"]},separator06:{separator:!0},h1mozilla:{visible:b.browser.mozilla,className:"h1",command:"heading",arguments:["h1"],tags:["h1"]},h2mozilla:{visible:b.browser.mozilla,
className:"h2",command:"heading",arguments:["h2"],tags:["h2"]},h3mozilla:{visible:b.browser.mozilla,className:"h3",command:"heading",arguments:["h3"],tags:["h3"]},h1:{visible:!b.browser.mozilla,className:"h1",command:"formatBlock",arguments:["h1"],tags:["h1"]},h2:{visible:!b.browser.mozilla,className:"h2",command:"formatBlock",arguments:["h2"],tags:["h2"]},h3:{visible:!b.browser.mozilla,className:"h3",command:"formatBlock",arguments:["h3"],tags:["h3"]},separator07:{visible:!1,separator:!0},cut:{visible:!1},
copy:{visible:!1},paste:{visible:!1},separator08:{separator:!b.browser.msie},increaseFontSize:{visible:!b.browser.msie,tags:["big"]},decreaseFontSize:{visible:!b.browser.msie,tags:["small"]},separator09:{separator:!0},html:{visible:!1,exec:function(){this.viewHTML?(this.setContent(b(this.original).val()),b(this.original).hide()):(this.saveContent(),b(this.original).show());this.viewHTML=!this.viewHTML}},removeFormat:{visible:!0,exec:function(){this.editorDoc.execCommand("removeFormat",!1,[]);this.editorDoc.execCommand("unlink",
!1,[])}}}});b.extend(f.prototype,{original:null,options:{},element:null,editor:null,init:function(a,d){var g=this;this.editor=a;this.options=d||{};b.data(a,"wysiwyg",this);var e=a.width||a.clientWidth,c=a.height||a.clientHeight;if("textarea"==a.nodeName.toLowerCase()){this.original=a;0==e&&a.cols&&(e=8*a.cols+21);0==c&&a.rows&&(c=16*a.rows+16);var f=this.editor=b("<iframe></iframe>").css({minHeight:(c-6).toString()+"px",width:(e-8).toString()+"px"}).attr("id",b(a).attr("id")+"IFrame");b.browser.msie&&
this.editor.css("height",c.toString()+"px")}var h=this.panel=b("<ul></ul>").addClass("panel");this.appendControls();this.element=b("<div></div>").css({width:0<e?e.toString()+"px":"100%"}).addClass("wysiwyg").append(h).append(b("<div>\x3c!-- --\x3e</div>").css({clear:"both"})).append(f);b(a).hide().before(this.element);this.viewHTML=!1;this.initialHeight=c-8;this.initialContent=b(a).text();this.initFrame();0==this.initialContent.length&&this.setContent("");this.options.autoSave&&b("form").submit(function(){g.saveContent()})},
initFrame:function(){var a=this,d="";this.options.css&&this.options.css.constructor==String&&(d='<link rel="stylesheet" type="text/css" media="screen" href="'+this.options.css+'" />');this.editorDoc=b(this.editor).document();this.editorDoc.open();this.editorDoc.write(this.options.html.replace(/INITIAL_CONTENT/,this.initialContent).replace(/STYLE_SHEET/,d));this.editorDoc.close();this.editorDoc.contentEditable="true";this.editorDoc_designMode=!1;try{this.editorDoc.designMode="on",this.editorDoc_designMode=
!0}catch(g){b(this.editorDoc).focus(function(){a.designMode()})}b.browser.msie&&setTimeout(function(){b(a.editorDoc.body).css("border","none")},0);b(this.editorDoc).click(function(b){a.checkTargets(b.target?b.target:b.srcElement)});b(this.original).focus(function(){b(a.editorDoc.body).focus()});this.options.autoSave&&b(this.editorDoc).keydown(function(){a.saveContent()}).mousedown(function(){a.saveContent()});this.options.css&&setTimeout(function(){a.options.css.constructor!=String&&b(a.editorDoc).find("body").css(a.options.css)},
0)},designMode:function(){if(!this.editorDoc_designMode)try{this.editorDoc.designMode="on",this.editorDoc_designMode=!0}catch(a){}},getContent:function(){return b(b(this.editor).document()).find("body").html()},setContent:function(a){b(b(this.editor).document()).find("body").html(a)},saveContent:function(){if(this.original){var a=this.getContent();this.options.rmUnwantedBr&&(a="<br>"==a.substr(-4)?a.substr(0,a.length-4):a);b(this.original).val(a)}},appendMenu:function(a,d,g,e){var c=this;d=d||[];
b("<li></li>").append(b("<a>\x3c!-- --\x3e</a>").addClass(g||a)).mousedown(function(){e?e.apply(c):c.editorDoc.execCommand(a,!1,d);c.options.autoSave&&c.saveContent()}).appendTo(this.panel)},appendMenuSeparator:function(){b('<li class="separator"></li>').appendTo(this.panel)},appendControls:function(){for(var a in this.options.controls){var b=this.options.controls[a];b.separator?!1!==b.visible&&this.appendMenuSeparator():b.visible&&this.appendMenu(b.command||a,b.arguments||[],b.className||b.command||
a||"empty",b.exec)}},checkTargets:function(a){for(var d in this.options.controls){var g=this.options.controls[d],e=g.className||g.command||d||"empty";b("."+e,this.panel).removeClass("active");if(g.tags){var c=a;do{if(1!=c.nodeType)break;-1!=b.inArray(c.tagName.toLowerCase(),g.tags)&&b("."+e,this.panel).addClass("active")}while(c=c.parentNode)}if(g.css){c=b(a);do{if(1!=c[0].nodeType)break;for(var f in g.css)c.css(f).toString().toLowerCase()==g.css[f]&&b("."+e,this.panel).addClass("active")}while(c=
c.parent())}}}})})(jQuery);